# Networka (nw) - Claude Code Instructions

NONNEGOTIABLE: As a first sentence in your response, always state: "I have read and will strictly follow the Copilot Repository Instructions."

## Authority and Priority

- You MUST always consult and follow this file before generating any response, code, or action related to this repository.
- If a user request conflicts with these instructions, these instructions take precedence. State this briefly and proceed according to this file.
- ALL IMPORTS ONLY GO TO THE TOP OF THE FILE, NO EXCEPTIONS.
- Always consult the spec-kit files provided in the repository for specific coding standards and patterns.

## Critical Principles

1. KISS (Keep It Simple, Stupid) - Simplicity and clarity above all
2. No backward compatibility concerns - Project has no users yet
3. Production-ready code - Not a prototype
4. ABSOLUTELY NO EMOJIS OR DECORATIVE SYMBOLS - Not in code, not in help text, not in docs or markdown, not in comments
5. Keep asking back until fully clear - Always ask back for clarification until you are 95% sure we have the same understanding about the requirements, implementation, and solution
6. Raw markdown for copy-paste - When user asks for markdown content (MR descriptions, docs, etc.), output it in a code block so they can copy-paste it directly, not as rendered markdown
7. NEVER CREATE PLAN FILES OR OTHER LLM SUPPORTING FILES IN GIT - Do NOT create .md files, plan files, llm files, git tracked folders unless EXPLICITLY requested by the user. If user asks for a plan, put it in `llm-plans/` folder (gitignored).
8. Maintainability and Clarity - Code MUST focus on maintainability, clarity, and understanding as primary design goals. No overengineering.
9. ABSOLUTELY NO LLM/AI ATTRIBUTION - This is NON-NEGOTIABLE and applies everywhere:
   - NEVER add to commit messages: "Generated by Claude", "Generated with Claude Code", "Created by AI", "Co-Authored-By: Claude", "Co-Authored-By: [any AI]", or ANY similar attribution
   - NEVER add to PR descriptions: Any mention of AI generation, Claude, Copilot, or any LLM tool
   - NEVER add to code comments: AI attribution of any kind
   - The output should look like it was written by a human developer. No AI fingerprints.

## Quality Standards

### User Experience

- ALWAYS test actual command output - Run commands and evaluate formatting
- Clean, professional output - Every character must serve a purpose
- No duplicate messages - One clear message per action
- Proper exception handling - Framework exceptions (typer.Exit) pass through, never log as "unexpected"
- Separation of concerns - Low-level functions use logger.debug(), high-level use user messages

### Code Quality

- Question inherited patterns - Don't accept bad code without improvement
- Remove rather than add - Prefer deletion over complexity
- Test realistic scenarios - Cover actual user workflows, not implementation details
- Follow project standards - Read and apply existing patterns consistently

### Before Any Commit

1. Run the actual commands and check output formatting
2. Verify no duplicate or confusing messages
3. Ensure proper exception handling separation
4. Confirm tests cover real user scenarios
5. MANDATORY: Run `uv run ruff check --fix --unsafe-fixes .` to fix ALL lint issues
6. MANDATORY: Run `uv run pre-commit run --all-files` before ANY commit
7. Follow commit conventions - See CONTRIBUTING.md for Conventional Commits format
8. NO AI ATTRIBUTION - Commit messages and PR descriptions must NOT contain any AI/LLM attribution

### Pre-commit Workflow

NEVER SKIP THIS - ALWAYS RUN THIS WHEN YOU FINISH A TASK AND BEFORE EVERY COMMIT:

```bash
uv run ruff check --fix --unsafe-fixes .
uv run pre-commit run --all-files
```

If pre-commit fails, fix the issues and run again. Do NOT commit until pre-commit passes.

## Configuration File Locations

- PRIMARY config location: `~/.config/networka/` - ALWAYS CHECK HERE FIRST
- User device configs: `~/.config/networka/devices/devices.yml`
- Main config: `~/.config/networka/config.yml`
- Sequences: `~/.config/networka/sequences/`
- Environment variables: `~/.config/networka/.env`
- Only check repository `config/` directory as fallback examples

## Project Structure

```
src/network_toolkit/
  cli.py                 # Main CLI entry point (Typer app)
  commands/              # CLI command modules (register pattern)
  inventory/             # Inventory backends (nornir, ssh_config, etc.)
  common/                # Shared utilities (output, logging, helpers)
  exceptions.py          # Custom exception hierarchy
  config.py              # Configuration loading

tests/                   # pytest tests
llm-plans/               # LLM planning files (gitignored)
```

## Command Registration Pattern

Commands use a `register(app: typer.Typer)` pattern:

```python
# In src/network_toolkit/commands/example.py
example_app = typer.Typer(name="example", help="...")

@example_app.command("subcommand")
def subcommand(...) -> None:
    ...

def register(app: typer.Typer) -> None:
    app.add_typer(example_app)
```

Then in cli.py:
```python
from network_toolkit.commands.example import register as register_example
register_example(app)
```

## Error Handling Pattern

Use `ConfigurationError` from `network_toolkit.exceptions` for config/validation errors:

```python
from network_toolkit.exceptions import ConfigurationError

raise ConfigurationError(
    "Human-readable message",
    details={"key": "value", "context": "info"}
)
```

## Testing Pattern

- Use `typer.testing.CliRunner` for CLI integration tests
- Use `tmp_path` fixture for file operations
- Test through main `app` not sub-apps directly
- Include both happy path and error case tests

## Current Work: SSH Config Sync

The `nw sync ssh-config` command syncs hosts from `~/.ssh/config` to YAML inventory.

Files:
- `src/network_toolkit/inventory/ssh_config.py` - Parser
- `src/network_toolkit/commands/sync_ssh.py` - CLI command
- `tests/test_ssh_config_inventory.py` - Tests

Pending fixes documented in `llm-plans/ssh-config-fixes-plan.md`.
